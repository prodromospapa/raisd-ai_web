<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RAiSD-AI</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header>
    <h1>RAiSD-AI</h1>
    <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle color theme">ðŸŒ™</button>
  </header>
  <main>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash">
          {% for m in messages %}<div class="flash-item">{{ m }}</div>{% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>
  <footer>
    <p class="muted">Upload a VCF, VCF.GZ or BCF, select species & chromosome, then we infer best model and run RAiSDâ€‘AI.</p>
  </footer>
  <script src="{{ url_for('static', filename='app.js') }}" defer></script>
  <script>
  (function(){
    const pref = localStorage.getItem('theme');
    const sysDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if(pref === 'dark' || (!pref && sysDark)) document.body.classList.add('dark');
    const btn = document.getElementById('themeToggle');
    function setIcon(){ btn.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ðŸŒ™'; }
    setIcon();
    btn.addEventListener('click', ()=>{
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      setIcon();
      // adjust Plotly background if present
      if(window.Plotly){
        const color = getComputedStyle(document.body).getPropertyValue('--card').trim();
        const fg = getComputedStyle(document.body).getPropertyValue('--fg').trim();
        const els = document.querySelectorAll('#plotlyChart');
        els.forEach(el=>{ try { Plotly.relayout(el,{ paper_bgcolor: color, plot_bgcolor: color, 'xaxis.color': fg, 'yaxis.color': fg }); } catch(_){ } });
      }
    });
    // Update icon if OS preference changes and user hasn't explicitly chosen
    if(!pref && window.matchMedia){
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e=>{
        if(localStorage.getItem('theme')) return; // user override
        if(e.matches) document.body.classList.add('dark'); else document.body.classList.remove('dark');
        setIcon();
      });
    }
  })();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>